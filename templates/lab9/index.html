<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
    <style>
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
        }
        .container {
            text-align: center;
            color: white;
            padding: 20px;
            z-index: 10;
            position: relative;
        }
        h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #counter {
            font-size: 1.2em;
            margin: 15px 0;
        }
        .box {
            position: absolute;
            width: 80px;
            height: 80px;
            background: url('/static/lab9/box.jpg') no-repeat center;
            background-size: contain;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .box:hover {
            transform: scale(1.1);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .modal .message {
            font-size: 1.5em;
            color: white; /* –¢–ï–ö–°–¢ –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–Ø –ë–ï–õ–´–ô */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 20px;
            text-align: center;
        }
        .modal img {
            max-width: 300px;
            margin: 20px;
        }
        .modal button {
            padding: 10px 20px;
            font-size: 1.1em;
            background: gold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .error {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ üéÅ</h1>
        <div id="counter">–û—Å—Ç–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å: <span id="remaining">10</span> –∫–æ—Ä–æ–±–æ–∫</div>
        <div id="error" class="error"></div>
    </div>

    <div id="modal" class="modal">
        <div class="message" id="message"></div>
        <img id="gift-image" src="">
        <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        let boxes = [];
        let openedCount = 0;
        const MAX_OPENED = 3;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 10 –∫–æ—Ä–æ–±–æ–∫ –≤ —Å–ª—É—á–∞–π–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
        function createBoxes() {
            const container = document.body;
            for (let i = 0; i < 10; i++) {
                const box = document.createElement('div');
                box.className = 'box';
                box.dataset.id = i;
                // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–Ω–æ –Ω–µ –∑–∞ —ç–∫—Ä–∞–Ω–æ–º)
                const x = Math.random() * (window.innerWidth - 100);
                const y = Math.random() * (window.innerHeight - 150) + 50;
                box.style.left = x + 'px';
                box.style.top = y + 'px';
                box.addEventListener('click', () => openBox(i));
                container.appendChild(box);
                boxes.push(box);
            }
        }

        async function openBox(boxId) {
            const response = await fetch('/lab9/open', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({box_id: boxId})
            });
            const data = await response.json();

            if (data.success) {
                document.getElementById('message').textContent = data.message;
                document.getElementById('gift-image').src = data.image;
                document.getElementById('modal').style.display = 'flex';
                // –£–±–∏—Ä–∞–µ–º –∫–æ—Ä–æ–±–∫—É
                boxes[boxId].style.display = 'none';
                openedCount++;
                document.getElementById('remaining').textContent = 10 - openedCount;
            } else {
                document.getElementById('error').textContent = data.error;
                setTimeout(() => document.getElementById('error').textContent = '', 3000);
            }
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        window.onload = createBoxes;
    </script>
</body>
</html>